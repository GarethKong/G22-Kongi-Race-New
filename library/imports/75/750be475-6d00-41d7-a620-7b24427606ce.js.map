{"version":3,"sources":["assets/Scripts/Common/DialogManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ccclass = cc._decorator.ccclass;\nimport property = cc._decorator.property;\nimport GameState from \"./GameState\";\n\n@ccclass\nexport default class DialogManager extends cc.Component {\n\n    @property(cc.Prefab)\n    antiContactLayerPrefab: cc.Prefab = null;\n\n    @property(cc.Node)\n    uiRoot: cc.Node = null;\n\n    dlgList: any = null;\n    antiContactLayer = null;\n\n    static _ins: DialogManager;\n\n    static get instance(): DialogManager {\n        return this._ins || new DialogManager;\n    }\n\n    onLoad() {\n        DialogManager._ins = this;\n        this.dlgList = new Array();\n        this.antiContactLayer = null;\n    }\n\n    start() {\n    }\n\n\n    /**\n     * 展示对话框\n     * @param {*对话框预设} prefab\n     * @param {*父节点} parent\n     * @param {*坐标} pos\n     */\n    showDlg(prefab, parent, pos = cc.v2(0, 0)) {\n\n        if (this.dlgList.length == 0) {\n            this.setAntiContactLayerActive(true);\n            GameState.isPauseGame = true;\n        }\n        let dlg = cc.instantiate(prefab);\n        let newPos = cc.v2(pos.x, pos.y);\n        parent.addChild(dlg);\n        dlg.setPosition(newPos);\n        this.antiContactLayer.setPosition(newPos);\n        dlg.setScale(0.5);\n        dlg.runAction(cc.scaleTo(0.3, 1, 1));\n\n        this.dlgList.push(dlg);\n\n        return dlg;\n    }\n\n    /**\n     * 关闭特定窗口\n     * @param {*窗口} dlg\n     */\n    removeDlg(dlg) {\n        let idx = this.dlgList.indexOf(dlg);\n        if (idx > -1) {\n            this.dlgList.splice(idx, 1);\n        }\n\n        dlg.destroy();\n\n        if (this.dlgList.length == 0) {\n            this.setAntiContactLayerActive(false);\n\n            GameState.isPauseGame = false;\n        }\n\n        if (this.antiContactLayer != null) {\n            this.antiContactLayer.removeFromParent();\n            this.antiContactLayer.destroy();\n            this.antiContactLayer = null;\n        }\n    }\n\n\n    /**\n     * 关闭最上层窗口\n     */\n    popDlg() {\n        let idx = this.dlgList.length - 1;\n\n        let dlg = this.dlgList[idx];\n\n        if (dlg != null) {\n            dlg.destroy();\n        }\n\n        this.dlgList.splice(idx, 1);\n\n        if (this.dlgList.length == 0) {\n\n            this.setAntiContactLayerActive(false);\n\n            GameState.isPauseGame = false;\n        }\n    }\n\n    /**\n     * 关闭所有窗口，一般在切换场景时调用\n     */\n    removeAllDlgs() {\n        for (let i = 0; i < this.dlgList.length; i++) {\n            let dlg = this.dlgList[i];\n\n            if (dlg != null) {\n                dlg.destroy();\n            }\n        }\n\n        if (this.antiContactLayer != null) {\n            this.antiContactLayer.removeFromParent();\n            this.antiContactLayer.destroy();\n            this.antiContactLayer = null;\n        }\n\n        GameState.isPauseGame = false;\n    }\n\n\n    // update (dt) {},\n\n    /**\n     * 设置防触层活性\n     * @param isActive\n     */\n    setAntiContactLayerActive(isActive: boolean) {\n        if (isActive) {\n            if (this.antiContactLayer == null) {\n                this.antiContactLayer = cc.instantiate(this.antiContactLayerPrefab);\n                this.uiRoot.addChild(this.antiContactLayer);\n            }\n            this.antiContactLayer.active = true;\n        } else {\n            if (this.antiContactLayer != null) {\n                this.antiContactLayer.active = false;\n            }\n        }\n    }\n}"]}