{"version":3,"sources":["assets/Scripts/Screen/Home/HomeLevelScript.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ccclass = cc._decorator.ccclass;\nimport property = cc._decorator.property;\nimport HomeLevelItem from \"./HomeLevelItem\";\n\n\n@ccclass\nexport default class HomeLevelScript extends cc.Component {\n\n    @property({displayName: 'spacing'})\n    public spacing: number = 0; // space between each item\n\n    @property({displayName: 'spawnCount'})\n    public spawnCount: number = 0; // how many items we actually spawn\n\n    @property({displayName: 'bufferZone'})\n    public bufferZone: number = 0; // when item is away from bufferZone, we relocate it\n\n    @property(cc.ScrollView)\n    public svLevel: cc.ScrollView = null;\n\n    @property(cc.Node)\n    public content: cc.Node = null;\n\n    @property(cc.Prefab)\n    public itemPrefab: cc.Prefab = null;\n\n    items: cc.Node[] = null;\n    updateTimer: number = 0;\n    updateInterval: number = 0;\n    lastContentPosX: number = 0;\n    listRankSize: number = 0;\n\n    isDraw: boolean = false;\n\n    itemTemplate: cc.Node = null\n\n\n    static _ins: HomeLevelScript;\n\n    static get instance(): HomeLevelScript {\n        return this._ins || new HomeLevelScript;\n    }\n\n\n    onLoad() {\n        HomeLevelScript._ins = this;\n        this.items = []; // array to store spawned items\n        this.updateTimer = 0;\n        this.updateInterval = 0.2;\n        this.lastContentPosX = 0; // use this variable to detect if we are scrolling up or down\n        this.itemTemplate = cc.instantiate(this.itemPrefab);\n    }\n\n    start() {\n        this.loadData();\n    }\n\n\n    loadData() {\n        let self = this;\n        let listData = [];\n        for (let i = 0; i < 30; i++) {\n            listData.push(i);\n        }\n        self.listRankSize = listData.length;\n        self.updateRankingUIView(listData);\n\n    }\n\n    updateRankingUIView(entries) {\n        let self = this;\n        this.content.width = entries.length * (this.itemTemplate.width + this.spacing) + this.spacing; // get total content height\n        for (let i = 0; i < this.spawnCount; ++i) { // spawn items, we only need to do this once\n            var item = cc.instantiate(this.itemPrefab);\n            this.content.addChild(item);\n            item.setPosition(item.width * (0.5 + i) + this.spacing * (i + 1), 0);\n            item.getComponent(HomeLevelItem).init(i + 1);\n            this.items.push(item);\n            console.log('Size list la' + this.items.length + 'height' + this.content.height);\n        }\n        console.log(\"already comehere3\");\n        this.scrollToFixedPosition();\n    }\n\n    show() {\n        this.isDraw = true;\n    }\n\n    hide() {\n        this.isDraw = false;\n        this.node.active = false;\n    }\n\n    update(dt) {\n        this.updateTimer += dt;\n        if (this.updateTimer < this.updateInterval) return; // we don't need to do the math every frame\n        this.updateTimer = 0;\n        let items = this.items;\n        let buffer = this.bufferZone;\n        let isRight = this.content.x > this.lastContentPosX; // scrolling direction\n        let offset = (this.itemTemplate.width + this.spacing) * items.length;\n        for (let i = 0; i < items.length; ++i) {\n            let viewPos = this.getPositionInView(items[i]);\n            if (isRight) {\n                //console.log('BINH: right');\n\n                // if away from buffer zone and not reaching left of content\n                if (viewPos.x > buffer && items[i].x - offset > 0) {\n                    items[i].x = items[i].x - offset;\n                    let item = items[i].getComponent(HomeLevelItem);\n                    let itemId = item.level - items.length; // update item id\n                    item.updateItem(itemId);\n                    console.log('BINH: update item left', this.lastContentPosX);\n                }\n            } else {\n                // if away from buffer zone and not reaching right of content\n                //console.log('BINH: left');\n\n                if (viewPos.x < -buffer && items[i].x + offset < this.content.width) {\n                    items[i].x = items[i].x + offset;\n                    let item = items[i].getComponent(HomeLevelItem);\n                    let itemId = item.level + items.length;\n                    item.updateItem(itemId);\n                    console.log('BINH: update item right', this.lastContentPosX);\n                }\n            }\n        }\n        // update lastContentPosY\n        this.lastContentPosX = this.content.x;\n    }\n\n    getPositionInView(item) { // get item position in scrollview's node space\n        let worldPos = item.parent.convertToWorldSpaceAR(item.position);\n        let viewPos = this.svLevel.node.convertToNodeSpaceAR(worldPos);\n        return viewPos;\n    }\n\n    scrollToFixedPosition() {\n        this.svLevel.scrollToOffset(cc.v2(0, 0), 2, false);\n    }\n}\n"]}